## è®¢å•ç®¡ç†

- èƒ½å¤Ÿå®Œæˆè®¢å•çš„åˆ›å»º
- èƒ½å¤Ÿé€šæŸ¥çœ‹è®¢å•çš„è¯¦ç»†ä¿¡æ¯
- èƒ½å¤Ÿäº†è§£è®¢å•çš„ä¸åŒçŠ¶æ€
- èƒ½å¤Ÿå®Œæˆè®¢å•æ”¯ä»˜
- èƒ½å¤Ÿæ ¹æ®è®¢å•çŠ¶æ€å±•ç¤ºè®¢å•åˆ—è¡¨

![image-20230302175301287](https://cdn.jsdelivr.net/gh/zengzjie/picgo-image@main/static_files/202303021753453.png)

![image-20230302180026507](https://cdn.jsdelivr.net/gh/zengzjie/picgo-image@main/static_files/202303021800550.png)

![image-20230302180042145](https://cdn.jsdelivr.net/gh/zengzjie/picgo-image@main/static_files/202303021800175.png)

### 1. è®¢å•ä¿¡æ¯

è®¢å•ä¿¡æ¯æ˜¯æ ¹æ®ç”¨æˆ·æ‰€é€‰çš„å•†å“ç”Ÿæˆä¸€ä¸ªä¸´æ—¶æ€§çš„è®¢å•ï¼Œåœ¨é¢„è®¢å•ä¸­é™¤äº†å±•ç¤ºå¾…è´­ä¹°çš„å•†å“ä¿¡æ¯å¤–ï¼Œè¿˜ä¼šå°†æŠ˜æ‰£ã€è¿è´¹ã€æ€»é‡‘é¢ç­‰ä¿¡æ¯æ±‡æ€»å‡ºæ¥ï¼Œç”±ç”¨æˆ·é€‰æ‹©æ”¶è´§åœ°å€åå†å»åˆ›å»ºè®¢å•å®Œæˆè´­ä¹°ã€‚

ç›®å‰æ”¯æŒä¸¤ç§æ–¹å¼ç”Ÿæˆè®¢å•ä¿¡æ¯ï¼Œåˆ†åˆ«æ˜¯è´­ç‰©è½¦ç»“ç®—å’Œç«‹å³è´­ä¹°

#### å»ç»“ç®—ï¼š

1. æ•°æ®éªŒè¯

åœ¨è´­ç‰©è½¦é¡µé¢ä¸­ç”¨æˆ·é€‰æ‹©äº†å¾…è´­ä¹°çš„å•†å“åï¼Œç‚¹å‡»ã€å»ç»“ç®—ã€‘å¯ä»¥æŸ¥çœ‹é€‰ä¸­çš„å•†å“æ‰€ç”Ÿæˆçš„è®¢å•ä¿¡æ¯ï¼Œæ­¤æ—¶ä¼šè·³è½¬åˆ°è®¢å•ä¿¡æ¯é¡µé¢ï¼Œä¸è¿‡åœ¨è¿™ä¹‹å‰è¦æ±‚ç”¨æˆ·è‡³å°‘é€‰ä¸­äº† 1 ä¸ªå•†å“ï¼Œå¦åˆ™ä¸å…è®¸ç”¨æˆ·ç‚¹å‡»ã€å»ç»“ç®—ã€‘æŒ‰é’®ï¼Œå› æ­¤é¦–å…ˆæˆ‘ä»¬éœ€è¦è¿›è¡Œæ•°æ®çš„éªŒè¯ã€‚

æ ¹æ®è®¡ç®—å±æ€§ é€‰ä¸­æ€»æ•°é‡ å¯ä»¥åˆ¤æ–­ç”¨æˆ·æ˜¯å¦è‡³å°‘é€‰ä¸­äº†ä¸€ä¸ªå•†å“ï¼Œå½“é€‰ä¸­æ•°é‡ä¸º 0 æ—¶è¡¨æ˜æ²¡æœ‰é€‰æ‹©ä»»ä½•å•†å“ï¼Œæ­¤æ—¶æˆ‘ä»¬ä¸å…è®¸è·³è½¬ï¼Œå¹¶ä¸”å°†ã€å»ç»“ç®—ã€‘æŒ‰é’®ç½®æˆç¦ç”¨çŠ¶æ€ï¼Œå³æ·»åŠ äº‹å…ˆå®šä¹‰å¥½çš„ disabled ç±»åï¼š

```vue
<view class="buttons">
 	<view :class="['button', 'payment', selectedCartsCount === 0 ? 'disabled' : '']" @tap="goToOrderCreate">
    å»ç»“ç®—ï¼ˆ{{ selectedCartsCount }}ï¼‰
  </view>
</view>
```

```tsx
// å»ç»“ç®—
const goToOrderCreate = () => {
  if (selectedCartsCount.value === 0) {
    uni.showToast({
      title: 'è¯·é€‰æ‹©å•†å“',
      icon: 'none'
    });
    return;
  }
  // è·³è½¬åˆ°è®¢å•åˆ›å»ºé¡µï¼ˆå¡«å†™è®¢å•ï¼‰
  uni.navigateTo({ url: '/pages/order/create' });
};
```

æ¥å£è°ƒç”¨ï¼š

æ¥å£åœ°å€ï¼š/member/order/pre

è¯·æ±‚æ–¹å¼ï¼šGET

ç™»å½•æƒé™: æ˜¯

è¯·æ±‚å‚æ•°ï¼šæ— 

æˆåŠŸå“åº”çš„æ•°æ®ï¼š

| å­—æ®µåç§°      | æ•°æ®ç±»å‹ | å¤‡æ³¨                   |
| ------------- | -------- | ---------------------- |
| goods         | Array    | é¢„è®¢å•å•†å“ä¿¡æ¯         |
| summary       | Object   | è®¢è®¢æŠ˜æ‰£ã€è¿è´¹ã€é‡‘é¢ç­‰ |
| userAddresses | Array    | æ”¶è´§äººåœ°å€             |

**goods**

| å­—æ®µåç§°  | æ•°æ®ç±»å‹ | å¤‡æ³¨          |
| --------- | -------- | ------------- |
| id        | String   | å•†å“ID        |
| name      | String   | å•†å“åç§°      |
| picture   | String   | å›¾ç‰‡åœ°å€      |
| attrsText | String   | å•†å“è§„æ ¼/å‹å· |
| count     | Number   | å•†å“æ•°é‡      |
| price     | Number   | å•†å“åŸå§‹ä»·æ ¼  |
| payPrice  | Number   | å•†å“æ”¯ä»˜ä»·æ ¼  |
| skuId     | String   | åº“å­˜å•ä½ ID   |

**summary**

| å­—æ®µåç§°      | æ•°æ®ç±»å‹ | å¤‡æ³¨         |
| ------------- | -------- | ------------ |
| discountPrice | Number   | æŠ˜æ‰£ä¿¡æ¯     |
| goodsCount    | Number   | å•†å“æ•°é‡åˆè®¡ |
| postFee       | Number   | è¿è´¹         |
| totalPayPrice | Number   | æ€»ä»·ï¼ˆå®ä»˜ï¼‰ |
| totalPrice    | Number   | æ€»ä»·         |

**userAddresses**

| å­—æ®µåç§°      | æ•°æ®ç±»å‹ | å¤‡æ³¨      |
| ------------- | -------- | --------- |
| address       | String   | è¯¦ç»†åœ°å€  |
| userAddresses | String   | çœå¸‚åŒº/å¿ |
| receiver      | String   | æ”¶è´§äºº    |
| contact       | String   | è”ç³»ç”µè¯  |

```tsx
/**
 * è·å–é¢„ä»˜è®¢å•(å¡«å†™è®¢å•)
 */
export function getMemberOrderPre() {
  return http<GetMemberOrderPreResult>({
    method: 'GET',
    url: '/member/order/pre'
  });
}
```

#### ç«‹å³è´­ä¹°ï¼š

åœ¨å•†å“è¯¦æƒ…é¡µé¢ç”¨æˆ·é™¤äº†å¯ä»¥å°†å•†å“æ·»åŠ è‡³è´­ç‰©è½¦å¤–ï¼Œè¿˜å¯ä»¥é€‰æ‹©ã€ç«‹å³è´­ä¹°ã€‘ï¼Œä»è€Œå°†å•†å“è¯¦æƒ…æ‰€å¯¹åº”å•†å“ç›´æ¥ç”Ÿæˆè®¢å•ä¿¡æ¯ï¼Œä¸è´­ç‰©è½¦ã€å»ç»“ç®—ã€‘ä¸åŒçš„æ˜¯é€‰æ‹©ã€ç«‹å³è´­ä¹°ã€‘éœ€è¦å°†è´­ä¹°å•†å“çš„ä¿¡æ¯ä¼ é€’åˆ°è®¢å•ä¿¡æ¯é¡µé¢ï¼Œæˆ‘ä»¬é€šè¿‡ä¼ é€’å‚æ•°ã€‚

åœ¨è·³è½¬åˆ°è®¢å•ä¿¡æ¯é¢ä¹‹å‰éœ€è¦è·å–å½“å‰å•†å“è¯¦æƒ…å¯¹åº”çš„å•†å“ä¿¡æ¯ï¼Œå¹¶æŠŠè¿™äº›ä¿¡æ¯ä¼ é€’åˆ°è®¢å•ä¿¡æ¯é¡µé¢ï¼Œè¿™äº›ä¿¡æ¯åŒ…æ‹¬ 3 ä¸ªæ•°æ®ï¼Œåˆ†åˆ«ä¸º skuIdã€count ä»¥åŠ addressIdï¼Œè¿™ 3 ä¸ªæ•°æ®åœ¨ä¹‹å‰çš„é€»è¾‘ä¸­æˆ‘ä»¬å·²ç»å¤„ç†å¥½äº†ï¼Œç°åœ¨åªéœ€è¦å¯¹å®ƒä»¬è¿›è¡Œè¯»å–å¹¶ä¼ é€’å³å¯ã€‚

æˆ‘ä»¬é€šè¿‡å®ç°é¡µé¢ä¹‹é—´çš„å‚æ•°ä¼ é€’ï¼š

```tsx
// ç‚¹å‡»ç«‹å³è´­ä¹°
const handleBuyNow = (ev: SkuEvent) => {
  const skuId = ev._id;
  const count = ev.buy_num;
  const addressId = selectedAddress.value.id;
  uni.navigateTo({
    url: `/pages/order/create?skuId=${skuId}&count=${count}&addressId=${addressId}`
  });
  // å…³é—­ SKU ç»„ä»¶
  isShowSku.value = false;
};
```

è®¢å•é¡µé¢æ¥æ”¶ä¼ é€’è¿‡æ¥çš„æ•°æ®ï¼š

```tsx
const props = defineProps<{
  skuId: string;
  count: number;
  addressId: string;
}>();

onLoad(async () => {
  if (props.skuId) {
    // å¦‚æœæœ‰é¡µé¢å‚æ•°ï¼Œè°ƒç”¨ç«‹å³è´­ä¹°
    orderPre.value = await getMemberOrderPreNow(props);
  } else {
    // æ²¡æœ‰é¡µé¢å‚æ•°ï¼Œæ™®é€šé¢„ä»˜è®¢å•
    orderPre.value = await getMemberOrderPre();
  }
});
```

æ¥å£è°ƒç”¨ï¼š

æ¥å£åœ°å€ï¼š/member/order/pre/now

è¯·æ±‚æ–¹å¼ï¼šGET

ç™»å½•æƒé™: æ˜¯

è¯·æ±‚å‚æ•°ï¼š

**Query**

| å­—æ®µåç§°  | æ˜¯å¦å¿…é¡» | é»˜è®¤å€¼ | å¤‡æ³¨       |
| --------- | -------- | ------ | ---------- |
| skuId     | æ˜¯       | æ—      | å•†å“åº“å­˜ID |
| count     | æ˜¯       | æ—      | å•†å“æ•°é‡   |
| addressId | æ˜¯       | æ—      | æ”¶è´§åœ°å€ID |

æˆåŠŸå“åº”çš„æ•°æ®ï¼š

| å­—æ®µåç§°      | æ•°æ®ç±»å‹ | å¤‡æ³¨                   |
| ------------- | -------- | ---------------------- |
| goods         | Array    | é¢„è®¢å•å•†å“ä¿¡æ¯         |
| summary       | Object   | è®¢è®¢æŠ˜æ‰£ã€è¿è´¹ã€é‡‘é¢ç­‰ |
| userAddresses | Array    | æ”¶è´§äººåœ°å€             |

**goods**

| å­—æ®µåç§°  | æ•°æ®ç±»å‹ | å¤‡æ³¨          |
| --------- | -------- | ------------- |
| id        | String   | å•†å“ID        |
| name      | String   | å•†å“åç§°      |
| picture   | String   | å›¾ç‰‡åœ°å€      |
| attrsText | String   | å•†å“è§„æ ¼/å‹å· |
| count     | Number   | å•†å“æ•°é‡      |
| price     | Number   | å•†å“åŸå§‹ä»·æ ¼  |
| payPrice  | Number   | å•†å“æ”¯ä»˜ä»·æ ¼  |
| skuId     | String   | åº“å­˜å•ä½ ID   |

**summary**

| å­—æ®µåç§°      | æ•°æ®ç±»å‹ | å¤‡æ³¨         |
| ------------- | -------- | ------------ |
| discountPrice | Number   | æŠ˜æ‰£ä¿¡æ¯     |
| goodsCount    | Number   | å•†å“æ•°é‡åˆè®¡ |
| postFee       | Number   | è¿è´¹         |
| totalPayPrice | Number   | æ€»ä»·ï¼ˆå®ä»˜ï¼‰ |
| totalPrice    | Number   | æ€»ä»·         |

**userAddresses**

| å­—æ®µåç§°      | æ•°æ®ç±»å‹ | å¤‡æ³¨      |
| ------------- | -------- | --------- |
| address       | String   | è¯¦ç»†åœ°å€  |
| userAddresses | String   | çœå¸‚åŒº/å¿ |
| receiver      | String   | æ”¶è´§äºº    |
| contact       | String   | è”ç³»ç”µè¯  |

```tsx
/**
 * ç«‹å³è´­ä¹°
 */
export function getMemberOrderPreNow(data: GetMemberOrderPreNowData) {
  return http<GetMemberOrderPreResult>({
    method: 'GET',
    url: '/member/order/pre/now',
    data
  });
}
```

### 2. åˆ›å»ºè®¢å•

#### å˜æ›´æ”¶è·åœ°å€ï¼š

åœ¨è®¢å•ä¿¡æ¯é¡µé¢ä¸­é»˜è®¤ä½¿ç”¨ç”¨æˆ·çš„é»˜è®¤åœ°å€åšä¸ºæ”¶è´§åœ°å€ï¼Œå¦‚æœç”¨æˆ·æƒ³è¦æ›´æ¢æ”¶è´§åœ°å€ä¹Ÿæ˜¯è¢«å…è®¸çš„ï¼Œåœ¨ç”¨æˆ·ç‚¹å‡»è®¢å•ä¿¡æ¯é¡µé¢ä¸­çš„æ”¶è´§åœ°å€åä¼šè·³è½¬åˆ°ã€åœ°å€åˆ—è¡¨ã€‘ä¸­ï¼Œç”¨æˆ·é‡æ–°é€‰æ‹©åœ°å€åè¿”å›åˆ°è®¢å•ä¿¡æ¯é¡µé¢ï¼Œå¹¶å°†ç”¨æˆ·é€‰æ‹©çš„æ”¶è´§åœ°å€è®¾ç½®ä¸ºæœ¬è®¢å•çš„æ”¶è´§åœ°å€ã€‚

åœ¨ç”¨æˆ·ç‚¹å‡»æ”¶è·åœ°å€åŒºåŸŸæ—¶ï¼Œè·³è½¬åˆ°åœ°å€åˆ—è¡¨ï¼Œå¹¶ä¸”åœ°å€æºå¸¦ `?from=order` å‚æ•°ï¼Œè¿™æ ·åœ¨é€‰æ‹©å®Œåœ°å€åç”¨æ¥åˆ¤æ–­æ˜¯å¦ä»è®¢å•åˆ›å»ºé¡µé¢è·³è½¬å¹¶é€‰æ‹©å®Œåœ°å€åå›é€€åˆ°è®¢å•åˆ›å»ºé¡µã€‚

æ”¶è´§åœ°å€å‡çº§æˆé€šè¿‡ Store å…¨å±€çŠ¶æ€å­˜å‚¨ï¼Œæ–¹ä¾¿åœ°å€åˆ—è¡¨é¡µã€è®¢å•å¡«å†™é¡µã€å•†å“è¯¦æƒ…é¡µ å¤šä¸ªé¡µé¢ä½¿ç”¨ï¼Œå…·ä½“å®ç°å¦‚ä¸‹æ‰€ç¤ºï¼š

```tsx
// é€‰æ‹©æ”¶è´§åœ°å€
const changeAddress = (item: MemberAddressItem) => {
  // åªæœ‰ä»è®¢å•é¡µé¢è·³è½¬è¿‡æ¥é€‰æ‹©åœ°å€åéœ€è¦å›é€€
  if (props.from === 'order') {
    // æ›´æ–° Stores é‡Œçš„æ”¶è´§åœ°å€
    changeSelectedAddress(item);
    uni.navigateBack();
  }
};
```

åœ¨è®¢å•åˆ›å»ºé¡µé¢ç‚¹å‡»æäº¤è®¢å•ä¼šè°ƒç”¨æ¥å£åˆ›å»ºæ–°çš„è®¢å•ï¼Œè°ƒç”¨æ¥å£å‰éœ€è¦å…ˆåˆ¤æ–­æœ‰æ²¡æœ‰æ”¶è·åœ°å€ï¼š

```tsx
// æäº¤è®¢å•
const submitForm = async () => {
  // ä» Store ä¸­è·å–é€‰ä¸­çš„æ”¶è´§åœ°å€
  const addressId = selectedAddress.value.id;
  // å¦‚æœæ²¡æœ‰æ”¶è´§åœ°å€
  if (!addressId) {
    // é€€å‡ºå‡½æ•°å¹¶å¼¹çª—æç¤º
    return uni.showToast({ icon: 'none', title: 'è¯·é€‰æ‹©æ”¶è´§åœ°å€~' });
  }
  // è°ƒç”¨åˆ›å»ºè®¢å•çš„æ¥å£ï¼Œè·å–è®¢å•id
  const { id } = await postMemberOrder({
    goods: orderPre.value.goods.map((v) => ({
      skuId: v.skuId,
      count: v.count
    })),
    addressId,
    deliveryTimeType: 1,
    payType: 1,
    payChannel: 2,
    buyerMessage: ''
  });
  // è·³è½¬åˆ°è®¢å•è¯¦æƒ…é¡µï¼Œå¹¶ä¼ é€’è®¢å•id
  uni.navigateTo({ url: `/pages/order/detail?id=${id}` });
};
```

æ¥å£è°ƒç”¨ï¼š

æ¥å£åœ°å€ï¼š/member/order

è¯·æ±‚æ–¹å¼ï¼šPOST

ç™»å½•æƒé™: æ˜¯

è¯·æ±‚å‚æ•°ï¼š

**Body**

| å­—æ®µåç§°         | æ˜¯å¦å¿…é¡» | é»˜è®¤å€¼ | å¤‡æ³¨                             |
| ---------------- | -------- | ------ | -------------------------------- |
| goods            | æ˜¯       | æ—      | è®¢å•å•†å“                         |
| addressId        | æ˜¯       | æ—      | æ”¶è´§åœ°å€ ID                      |
| deliveryTimeType | æ˜¯       | æ—      | é…é€æ—¶é—´                         |
| payType          | æ˜¯       | æ—      | æ”¯ä»˜æ–¹å¼                         |
| payChannel       | æ˜¯       | æ—      | æ”¯ä»˜æ¸ é“ï¼ˆå°ç¨‹åºä¸­å›ºå®šå¾®ä¿¡æ”¯ä»˜ï¼‰ |
| buyerMessage     | æ˜¯       | æ—      | ä¹°å®¶ç•™è¨€                         |

æˆåŠŸå“åº”çš„æ•°æ®ï¼š

| å­—æ®µåç§°   | æ•°æ®ç±»å‹ | å¤‡æ³¨         |
| ---------- | -------- | ------------ |
| id         | String   | è®¢å•ID       |
| orderState | Number   | è®¢å•çŠ¶æ€     |
| payChannel | Number   | æ”¯ä»˜æ¸ é“     |
| payType    | Number   | æ”¯ä»˜æ–¹å¼     |
| createTime | String   | åˆ›å»ºè®¢å•æ—¶é—´ |

```tsx
/**
 * æäº¤è®¢å•
 */
export function postMemberOrder(data: PostMemberOrderData) {
  return http<PostMemberOrderResult>({
    method: 'POST',
    url: '/member/order',
    data
  });
}
```

### 3. è®¢å•è¯¦æƒ…

åˆ›å»ºè®¢å•æˆåŠŸåä¼šè·³è½¬åˆ°è®¢å•è¯¦æƒ…é¡µé¢ï¼Œåœ¨è¿™ä¸ªé¡µé¢ä¸­å±•ç¤ºæŸä¸€ä¸ªè®¢å•çš„è¯¦ç»†ä¿¡æ¯

#### è·å–è®¢å•ID

é¦–å…ˆåœ¨è®¢å•ä¿¡æ¯é¡µé¢é€šè¿‡åœ°å€å‚æ•°ä¼ é€’è®¢å•çš„ ID

```tsx
onLoad(async () => {
  if (props.id) {
    order.value = await getMemberOrderById(props.id);
  }
});
```

æ¥å£è°ƒç”¨ï¼š

æ¥å£åœ°å€ï¼š/member/order/

è¯·æ±‚æ–¹å¼ï¼šGET

ç™»å½•æƒé™: æ˜¯

è¯·æ±‚å‚æ•°ï¼š

**è·¯å¾„å‚æ•°**

| å­—æ®µåç§° | æ˜¯å¦å¿…é¡» | é»˜è®¤å€¼ | å¤‡æ³¨   |
| -------- | -------- | ------ | ------ |
| id       | æ˜¯       | æ—      | è®¢å•ID |

æˆåŠŸå“åº”çš„æ•°æ®ï¼š

| å­—æ®µåç§°        | æ•°æ®ç±»å‹ | å¤‡æ³¨     |
| --------------- | -------- | -------- |
| id              | String   | è®¢å•ID   |
| orderState      | Number   | è®¢å•çŠ¶æ€ |
| payChannel      | Number   | æ”¯ä»˜æ¸ é“ |
| payState        | Number   | æ”¯ä»˜çŠ¶æ€ |
| totalNum        | Number   | å•†å“æ•°é‡ |
| totalMoney      | Number   | å•†å“æ€»ä»· |
| postFee         | Number   | è¿è´¹     |
| payMoney        | Number   | æ”¯ä»˜é‡‘é¢ |
| receiverContact | String   | æ”¶è´§äºº   |
| receiverMobile  | String   | è”ç³»ç”µè¯ |
| receiverAddress | String   | æ”¶è´§åœ°å€ |
| skus            | Array    | è®¢å•å•†å“ |

**skus**

| å­—æ®µåç§°  | æ•°æ®ç±»å‹ | å¤‡æ³¨           |
| --------- | -------- | -------------- |
| id        | String   | å•†å“ID         |
| name      | String   | å•†å“åç§°       |
| image     | String   | å•†å“å›¾ç‰‡       |
| quantity  | Number   | å•†å“æ•°é‡       |
| attrsText | String   | å•†å“è§„æ ¼ã€å‹å· |
| curPrice  | Number   | å•†å“ä»·æ ¼       |
| realPay   | Number   | å®ä»˜ä»·æ ¼       |

```tsx
/**
 * è®¢å•è¯¦æƒ…æ¥å£
 */
export function getMemberOrderById(id: string) {
  return http<GetMemberOrderByIdResult>({
    method: 'GET',
    url: `/member/order/${id}`
  });
}
```

### 4. è®¢å•æ”¯ä»˜

#### å¾®ä¿¡æ”¯ä»˜è¯´æ˜ï¼š

ç”±äºå¾®ä¿¡å®‰å…¨é™åˆ¶ï¼Œè¯¥æ¥å£åªå…è®¸ç”³è¯·é€šè¿‡çš„ `appid` æ‰èƒ½è°ƒç”¨ï¼›

å…¶ä»–å¼€å‘è€…æ›´æ–°è®¢å•çŠ¶æ€ï¼Œå¯è°ƒç”¨æ¨¡æ‹Ÿæ¥å£æ”¯ä»˜æ¥å£ï¼Œè°ƒç”¨åè®¢å•çŠ¶æ€æ›´æ–°ä¸ºå·²æ”¯ä»˜ã€‚

####  è°ƒç”¨æ¥å£ï¼š

- æ­£å¼æ¥å£ï¼šæ”¯ä»˜-å¾®ä¿¡-å°ç¨‹åº
- æ¨¡æ‹Ÿæ¥å£ï¼šæ¨¡æ‹Ÿæ”¯ä»˜-æ›´æ–°è®¢å•æ”¯ä»˜çŠ¶æ€

### 5. è®¢å•åˆ—è¡¨

æ ¹æ®è®¢å•çš„ä¸åŒçŠ¶æ€å±•ç¤ºè®¢å•åˆ—è¡¨ã€‚

##### Tabäº¤äº’

åœ¨è®¢å•åˆ—è¡¨é¡µé¢èƒ½å¤Ÿé€šè¿‡ Tab çš„æ–¹æ³•åˆ‡æ¢æŸ¥çœ‹ä¸åŒçŠ¶æ€çš„è®¢å•åˆ—è¡¨ï¼ŒTab äº¤äº’ä½¿ç”¨åˆ°äº† swiper ç»„ä»¶ï¼Œç„¶åé…åˆ current å±æ€§å’Œ change äº‹ä»¶æ¥å®ç°ï¼š

```tsx
// swiperåˆ‡æ¢
const handleSwiperChange = (e: any) => {
  tabsIndex.value = e.detail.current;
  activeIndex.value = e.detail.current;
  // ğŸ””ä¼˜åŒ–ï¼šåœ¨æ»‘åŠ¨åˆ‡æ¢çš„æ—¶å€™ï¼Œå¦‚æœæ²¡æœ‰æ•°æ®ï¼Œæ‰éœ€è¦å‘é€è¯·æ±‚
  if (orderList.value[activeIndex.value].items.length === 0) {
    // åŠ è½½è®¢å•åˆ—è¡¨æ•°æ®
    loadOrderList();
  }
};
```

```tsx
// åŠ è½½è®¢å•åˆ—è¡¨
const loadOrderList = async () => {
  uni.showLoading({ title: 'åŠ è½½ä¸­...' });
  // è·å–å½“å‰è®¢å•åˆ—è¡¨
  const currOrderList = orderList.value[activeIndex.value];
  const res = await getMemberOrderList({
    page: currOrderList.page,
    pageSize: currOrderList.pageSize,
    orderState: OrderStateOptions[activeIndex.value].value
  });
  // éšè—åŠ è½½æç¤º
  uni.hideLoading();
  // åˆ—è¡¨æ•°æ®è¿½åŠ ï¼Œç”¨äºåˆ†é¡µ
  currOrderList.items.push(...res.items);
  // è®°å½•æ€»æ•°ï¼Œç”¨äºåˆ†é¡µ
  currOrderList.counts = res.counts;
  // ğŸ””å¦‚æœ æ€»è®°å½•æ•°é‡ æ¯” é¡µå®¹é‡è¿˜å°ï¼Œè¯´æ˜æ²¡åˆ†é¡µæ•°æ®äº†ï¼Œé¡µç æ— éœ€ç´¯åŠ 
  if (res.counts < res.pageSize) return;
  // é¡µç ç´¯åŠ ï¼Œç”¨äºåˆ†é¡µ
  currOrderList.page++;
};
```

æ¥å£è°ƒç”¨ï¼š

æ¥å£åœ°å€ï¼š/member/order

è¯·æ±‚æ–¹å¼ï¼šGET

ç™»å½•æƒé™: æ˜¯

è¯·æ±‚å‚æ•°ï¼š

**Query**

| å­—æ®µåç§°   | æ˜¯å¦å¿…é¡» | é»˜è®¤å€¼ | å¤‡æ³¨         |
| ---------- | -------- | ------ | ------------ |
| orderState | æ˜¯       | æ—      | è®¢å•çŠ¶æ€     |
| page       | å¦       | 1      | åˆ†é¡µé¡µç      |
| pageSize   | å¦       | 10     | æ¯é¡µæ•°æ®æ•°é‡ |

æˆåŠŸå“åº”çš„æ•°æ®ï¼š

| å­—æ®µåç§°   | æ•°æ®ç±»å‹ | å¤‡æ³¨     |
| ---------- | -------- | -------- |
| id         | String   | è®¢å•ID   |
| orderState | Number   | è®¢å•çŠ¶æ€ |
| payChannel | Number   | æ”¯ä»˜æ¸ é“ |
| payState   | Number   | æ”¯ä»˜çŠ¶æ€ |
| totalNum   | Number   | å•†å“æ•°é‡ |
| totalMoney | Number   | å•†å“æ€»ä»· |
| postFee    | Number   | è¿è´¹     |
| payMoney   | Number   | æ”¯ä»˜é‡‘é¢ |
| skus       | Array    | è®¢å•å•†å“ |

**skus**

| å­—æ®µåç§°  | æ•°æ®ç±»å‹ | å¤‡æ³¨           |
| --------- | -------- | -------------- |
| id        | String   | å•†å“ID         |
| name      | String   | å•†å“åç§°       |
| image     | String   | å•†å“å›¾ç‰‡       |
| quantity  | Number   | å•†å“æ•°é‡       |
| attrsText | String   | å•†å“è§„æ ¼ã€å‹å· |
| curPrice  | Number   | å•†å“ä»·æ ¼       |
| realPay   | Number   | å®ä»˜ä»·æ ¼       |

```tsx
/**
 * è®¢å•è¯¦æƒ…æ¥å£
 */
export function getMemberOrderList(data: GetMemberOrderListData) {
  return http<GetMemberOrderListResult>({
    method: 'GET',
    url: `/member/order`,
    data
  });
}
```

