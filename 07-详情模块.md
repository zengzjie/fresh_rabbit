## ğŸ” å•†å“è¯¦æƒ…

![image-20230301175500979](https://cdn.jsdelivr.net/gh/zengzjie/picgo-image@main/static_files/202303011755128.png)

å¸ƒå±€åˆ†æï¼š

```vue
<template>
  <GoodsSkeleton v-if="isShowSkeleton" />
  <template v-else>
    <scroll-view scroll-y enhanced :bounces="false" :show-scrollbar="false" scroll-with-animation class="goods">
      <view :style="{ height: globalProperties.$safeAreaInsets?.top + 'px' }"></view>
      <!-- å•†å“ä¿¡æ¯ -->
      <view class="goods-info">
        <view class="goods-info-preview">
          <swiper circular @change="handleSwiperChange">
            <swiper-item v-for="(url, index) in goods.mainPictures" :key="index">
              <image :src="url" @tap="previewImage(url)" />
            </swiper-item>
          </swiper>
          <view class="goods-info-preview--indicator">
            <text class="goods-info-preview--indicator__current">{{ current + 1 }}</text>
            <text class="goods-info-preview--indicator__split">/</text>
            <text class="goods-info-preview--indicator__total">{{ goods.mainPictures?.length }}</text>
          </view>
        </view>

        <view class="goods-info-meta">
          <view class="goods-info-meta--price">
            <text class="goods-info-meta--price__symbol">Â¥</text>
            <text class="goods-info-meta--price__number">{{ goods.price }}</text>
          </view>
          <view class="goods-info-meta--name ellipsis">
            {{ goods.name }}
          </view>
          <view class="goods-info-meta--remarks">{{ goods.desc }}</view>
        </view>
        <view class="goods-info-related">
          <view class="goods-info-related--item arrow" @tap="openSkuPopup(SkuMode.Cart)">
            <text class="goods-info-related--item__label">é€‰æ‹©</text>
            <text class="goods-info-related--item__text ellipsis">
              {{ selectArrText || 'è¯·é€‰æ‹©å•†å“è§„æ ¼' }}
            </text>
          </view>
          <view class="goods-info-related--item arrow" @tap="showHalfDialog('shipment')">
            <text class="goods-info-related--item__label">é€è‡³</text>
            <text class="goods-info-related--item__text ellipsis">å¹¿å·å¸‚å¤©æ²³åŒºxxxè·¯</text>
          </view>
          <view class="goods-info-related--item arrow" @tap="showHalfDialog('clause')">
            <text class="goods-info-related--item__label">æœåŠ¡</text>
            <text class="goods-info-related--item__text ellipsis">æ— å¿§é€€ å¿«é€Ÿé€€æ¬¾ å…è´¹åŒ…é‚®</text>
          </view>
        </view>
      </view>
      <!-- å•†å“è¯¦æƒ… -->
      <view class="goods-detail panel">
        <view class="panel-title">
          <text class="panel-title__text">å•†å“è¯¦æƒ…</text>
        </view>
        <view class="goods-detail--content">
          <view class="goods-detail--content__properties">
            <!-- å•†å“è¯¦æƒ…å±æ€§ -->
            <view
              v-for="item in goods.details?.properties"
              :key="item.name"
              class="goods-detail--content__properties__item"
            >
              <text class="goods-detail--content__properties__item__label">{{ item.name }}</text>
              <text class="goods-detail--content__properties__item__value">{{ item.value }}</text>
            </view>
          </view>

          <!-- å•†å“è¯¦æƒ…å›¾ç‰‡ -->
          <image v-for="(item, index) in goods.details?.pictures" :key="index" mode="widthFix" :src="item"></image>
        </view>
      </view>
      <!-- å¸¸è§é—®é¢˜ -->
      <view class="goods-help arrow" @tap="showHalfDialog('helps')">
        <text class="icon-help"></text>
        <navigator hover-class="none">å¸¸è§é—®é¢˜</navigator>
      </view>
      <!-- æ¨è -->
      <view class="goods-recommend panel">
        <view class="panel-title">
          <text class="panel-title__text">å•†å“æ¨è</text>
        </view>
        <view class="goods-recommend--content">
          <navigator
            v-for="item in goodsRelevants"
            :key="item.id"
            :url="`/pages/goods/index?id=${item.id}`"
            hover-class="none"
          >
            <image class="goods-recommend--content__image" mode="aspectFit" :src="item.picture"></image>
            <view class="goods-recommend--content__name ellipsis">
              {{ item.name }}
            </view>
            <view class="goods-recommend--content__price">
              <text class="goods-recommend--content__price__symbol">Â¥</text>
              <text class="goods-recommend--content__price__number">{{ item.price }}</text>
            </view>
          </navigator>
        </view>
      </view>
    </scroll-view>

    <!-- åº•éƒ¨æ“ä½œæ  -->
    <view class="actionbar safe-area-inset-bottom">
      <view class="actionbar-icons">
        <button class="actionbar-icons-collect">
          <text class="icon-heart"></text>
          æ”¶è—
        </button>
        <button class="actionbar-icons-contact" open-type="contact">
          <text class="icon-handset"></text>
          å®¢æœ
        </button>
        <button class="actionbar-icons-cart" @tap="goToCart">
          <text class="icon-cart"></text>
          è´­ç‰©è½¦
          <text class="actionbar-icons-cart__number" :style="{ '--tright': cartRight }">
            {{ totalCartNum }}
          </text>
        </button>
      </view>
      <view class="actionbar-buttons">
        <view class="actionbar-buttons-addcart" @tap="openSkuPopup(SkuMode.Cart)">åŠ å…¥è´­ç‰©è½¦</view>
        <view class="actionbar-buttons-payment" @tap="openSkuPopup(SkuMode.Buy)">ç«‹å³è´­ä¹°</view>
      </view>
    </view>

    <!-- popupå¼¹çª— -->
    <uni-popup ref="popup" type="bottom" background-color="#fff" safe-area is-mask-click>
      <view class="popup-root">
        <text class="close icon-close" @tap="hideHalfDialog"></text>
        <ShipmentPanel v-if="layer === 'shipment'" />
        <ClausePanel v-if="layer === 'clause'" />
        <HelpsPanel v-if="layer === 'helps'" />
      </view>
    </uni-popup>

    <!-- SKU å¼¹çª—ç»„ä»¶ -->
    <VkDataGoodsSkuPopup
      ref="skuRef"
      v-model="isShowSku"
      :mode="skuMode"
      :localdata="goodsSku"
      add-cart-background-color="#FFA868"
      buy-now-background-color="#28BA9A"
      price-color="#cf4444"
      :actived-style="{
        color: 'rgba(39, 186, 155)',
        borderColor: 'rgba(39, 186, 155)',
        backgroundColor: 'rgba(39, 186, 155, 0.1)'
      }"
      @add-cart="handleAddCart"
      @buy-now="handleBuyNow"
    />

    <!-- ç”¨äºè·å–è´­ç‰©è½¦æ•°é‡æ–‡æœ¬å®½åº¦ -->
    <canvas type="2d" canvas-id="myCanvas" style="display: none"></canvas>
  </template>
</template>
```

ä½¿ç”¨äº†éª¨æ¶å±çš„æ•ˆæœåœ¨æ•°æ®æœªåŠ è½½å®Œçš„æ—¶å€™å±•ç¤ºï¼Œä½¿ç”¨äº†æ¯”è¾ƒå¸¸è§„çš„å•†å“è¯¦æƒ…çš„é¡µé¢å¸ƒå±€ï¼Œå•†å“ä¿¡æ¯çš„å›¾ç‰‡è½®æ’­å’Œä¿¡æ¯çš„é€‰æ‹©ï¼Œå•†å“è¯¦æƒ…å›¾ç‰‡ã€å¸¸è§é—®é¢˜å±•ç¤ºï¼Œå•†å“æ¨èï¼Œç„¶ååº•éƒ¨çš„æŒ‰é’®åŒºåŸŸã€‚

åº•éƒ¨æŒ‰é’®åŒºä¸­çš„è´­ç‰©è½¦å›¾ç‰‡æ˜¯æœ‰ `badge` çš„å±•ç¤ºçš„ï¼Œä½†æ˜¯åœ¨åŸºäºè´­ç‰©è½¦å›¾æ ‡å»å®šä½å…¶ä½ç½®çš„æ—¶å€™åœ¨ä¸åŒçš„æœºå‹ä¸‹å…¶ `badge` çš„ä½ç½®ä¼šé”™ä½ä¸å‡†ç¡®ï¼Œåœ¨è¿™é‡Œæˆ‘ä½¿ç”¨äº† `canvas` å»å¤„ç†è·å–å½“å‰è´­ç‰©è½¦æ•°é‡ç„¶åç®—å‡ºå…¶æ–‡æœ¬çš„å®½åº¦ï¼Œç„¶ååˆ¤æ–­å…¶åœ¨ä¸åœ¨ä¸€å®šçš„èŒƒå›´å†…å¾—åˆ°åŠ¨æ€çš„åç§»å€¼ï¼Œè¿™æ · `badge` å°±å¯ä»¥åŠ¨æ€çš„æ ¹æ®æœºå‹å»åšåç§»è°ƒæ•´äº†ã€‚

```tsx
const totalCartNum = ref('99+');
const canvasTextWidth = ref(0);

// è·å–å¾½ç« å®½åº¦
const getBadgeWidth = async () => {
  // è·å–è´­ç‰©è½¦æ•°é‡é•¿åº¦
  const carts = await getMemberCart();
  if (carts.length > 99) {
    totalCartNum.value = '99+';
  } else {
    totalCartNum.value = String(carts.length);
  }
  const context = uni.createCanvasContext('myCanvas', instance);
  canvasTextWidth.value = context.measureText(totalCartNum.value).width;
};

// è¿™é‡Œæ˜¯ä¸ºäº†è·å–å½“å‰ç”¨æˆ·çš„è´­ç‰©è½¦æ•°é‡ï¼Œç”¨äºæ˜¾ç¤ºåœ¨è´­ç‰©è½¦å›¾æ ‡ä¸Š
onReady(() => {
  getBadgeWidth();
});

const cartRight = computed(() => {
  // 0-9  cartRight èŒƒå›´4 <= x <= 6
  // 10-99+ cartRight x = 0;
  let width = 0;
  if (4 <= canvasTextWidth.value && canvasTextWidth.value <= 6) {
    width = 20;
  } else {
    width = 0;
  }
  return `${width}rpx`;
});
```

æ¥å£è°ƒç”¨ï¼š

æ¥å£åœ°å€ï¼š/goods

è¯·æ±‚æ–¹å¼ï¼šGET

ç™»å½•æƒé™: å¦

è¯·æ±‚å‚æ•°ï¼š

**Query**

| å­—æ®µåç§° | æ˜¯å¦å¿…é¡» | é»˜è®¤å€¼ | å¤‡æ³¨   |
| -------- | -------- | ------ | ------ |
| id       | æ˜¯       | æ—      | å•†å“id |

æˆåŠŸå“åº”ç»“æœï¼š

| å­—æ®µåç§°     | æ•°æ®ç±»å‹ | å¤‡æ³¨            |
| ------------ | -------- | --------------- |
| name         | String   | å•†å“åç§°        |
| price        | Number   | å•†å“ä»·æ ¼        |
| mainPictures | Array    | å•†å“é¢„è§ˆå›¾ç‰‡    |
| brand        | Object   | å•†å“å“ç‰Œä¿¡æ¯    |
| specs        | Array    | å•†å“çš„è§„æ ¼/å‹å· |
| skus         | Array    | å•†å“åº“å­˜ä¿¡æ¯    |
| detail       | Object   | å•†å“è¯¦ç»†ä»‹ç»    |

```tsx
/**
 * å•†å“è¯¦æƒ…
 * @param id å•†å“id
 */
export function getGoodsById(id: string) {
  return http<GoodsResult>({
    method: 'GET',
    url: '/goods',
    data: { id }
  });
}
```

æ¨èåˆ—è¡¨çš„æ¥å£è°ƒç”¨ï¼š

```tsx
/**
 * åŒç±»æ¨è(ä¹Ÿæ”¯æŒçŒœä½ å–œæ¬¢)
 * @param data è¯·æ±‚å‚æ•°
 */
export function getGoodsRelevant(data: GetGoodsRelevantData) {
  return http<GoodsRelevantItem[]>({
    method: 'GET',
    url: '/goods/relevant',
    data: data
  });
}
```

## ğŸ§ Skuæ¨¡å—

![image-20230301182738092](https://cdn.jsdelivr.net/gh/zengzjie/picgo-image@main/static_files/202303011827203.png)

åº“å­˜å•ä½æ˜¯å•†å“è¯¦æƒ…ä¸­æ¯”è¾ƒå¤æ‚çš„çŸ¥è¯†ç‚¹ï¼ŒSKU æ˜¯ç”µå•†å¸¸è§ä¸šåŠ¡ï¼Œå¥½æ¶ˆæ¯æ˜¯ UniApp æ’ä»¶å¸‚åœºæœ‰æˆç†Ÿçš„ SKUç»„ä»¶æä¾›ï¼Œå¼€å‘è€…åªéœ€æŒ‰æ’ä»¶è¦æ±‚æä¾›æ•°æ®å³å¯ã€‚

### æ’ä»¶å¸‚åœº

![image-20230301182900426](https://cdn.jsdelivr.net/gh/zengzjie/picgo-image@main/static_files/202303011829490.png)

ä¸‹è½½åˆ°æŒ‡å®šä½ç½®ï¼š

![image-20230301182922933](https://cdn.jsdelivr.net/gh/zengzjie/picgo-image@main/static_files/202303011829985.png)

æ’ä»¶æ–‡æ¡£ï¼š[https://ext.dcloud.net.cn/plugin?id=2848](https://gitee.com/link?target=https%3A%2F%2Fext.dcloud.net.cn%2Fplugin%3Fid%3D2848)

###  æä¾›ç±»å‹å£°æ˜æ–‡ä»¶

æ’ä»¶å¹¶éé€šè¿‡ TS å¼€å‘ï¼Œæˆ‘ä»¬è‡ªå·±æ·»åŠ  TS ç±»å‹å£°æ˜æ–‡ä»¶å®ç°å®‰å…¨çš„æ•°æ®æ ¡éªŒã€‚

```tsx
/**
 * å•†å“å¯¹åº”çš„skuåˆ—è¡¨çš„å­—æ®µå
 */
export interface SkuItem {
  /**
   * å•†å“ä¿å­˜åº“å­˜æ§åˆ¶çš„æœ€å°å¯ç”¨å•ä½ sku_id
   */
  _id: string;
  /**
   * å•†å“id
   */
  goods_id: string;
  /**
   * å•†å“åç§°
   */
  goods_name: string;
  /**
   * å•†å“å›¾ç‰‡
   */
  image: string;
  /**
   * å•†å“ä»·æ ¼ï¼Œæ³¨æ„ï¼šè¿™é‡Œéœ€è¦ä¹˜ä»¥ 100
   */
  price: number;
  /**
   * å•†å“è§„æ ¼åç§°é›†åˆ
   */
  sku_name_arr: string[];
  /**
   * å•†å“åº“å­˜
   */
  stock: number;
}

/**
 * äº‹ä»¶å¯¹è±¡ï¼šå½“å‰é€‰æ‹©çš„skuæ•°æ®ï¼Œç»§æ‰¿äº SkuItem
 */
export interface SkuEvent extends SkuItem {
  /**
   * å•†å“è´­ä¹°æ•°é‡
   */
  buy_num: number;
}

/**
 * å•†å“è§„æ ¼åç§°çš„é›†åˆ
 */
export interface SpecItem {
  /**
   * è§„æ ¼å¯é€‰å€¼é›†åˆ
   */
  list: { name: string }[];
  /**
   * è§„æ ¼åç§°
   */
  name: string;
}

/**
 * å¤šç»„è§„æ ¼å•†å“æ ¼å¼
 */
export interface GoodsSku {
  /**
   * ä¿å­˜åº“å­˜æ§åˆ¶çš„æœ€å°å¯ç”¨å•ä½ sku_id
   */
  _id: string;
  /**
   * å•†å“åç§°
   */
  name: string;
  /**
   * å•†å“å›¾ç‰‡
   */
  goods_thumb: string;
  /**
   * å­—æ®µå - å•†å“å¯¹åº”çš„skuåˆ—è¡¨çš„å­—æ®µå
   */
  sku_list: SkuItem[];
  /**
   * å­—æ®µå - å•†å“è§„æ ¼åç§°çš„å­—æ®µå
   */
  spec_list: SpecItem[];
}

```

### æ•°æ®å¤„ç†

éœ€è¦æŒ‰æ’ä»¶è¦æ±‚å¤„ç†æ•°æ®æ ¼å¼ï¼Œæ•´ç†éœ€è¦çš„æ•°æ®åï¼Œç›´æ¥æ¸²æŸ“å³å¯ã€‚

```tsx
onLoad(async () => {
  if (props.id) {
    // æ ¹æ®å•†å“idè·å–å•†å“è¯¦æƒ…
    goods = await getGoodsById(props.id);
    // æ ¹æ®å•†å“idè·å–ç›¸å…³æ¨èå•†å“åˆ—è¡¨
    goodsRelevants = await getGoodsRelevant({ id: props.id, limit: 6 });
    // ğŸ¯ğŸ¯ğŸ¯ åŸºäºåç«¯è¿”å›çš„æ•°æ®ï¼Œå¤„ç†æˆ SKU ç»„ä»¶æ‰€éœ€çš„æ•°æ®æ ¼å¼
    goodsSku.value = {
      _id: goods.id,
      name: goods.name,
      goods_thumb: goods.mainPictures[0],
      sku_list: goods.skus.map((item) => {
        return {
          _id: item.id,
          goods_id: goods.id,
          goods_name: goods.name,
          image: goods.mainPictures[0],
          price: item.price * 100,
          sku_name_arr: item.specs.map((v) => v.valueName),
          stock: item.inventory
        };
      }),
      spec_list: goods.specs.map((item) => {
        return {
          name: item.name,
          list: item.values.map((v) => ({ name: v.name }))
        };
      })
    };
    isShowSkeleton.value = false;
  }
});
```

###  SKUå±•ç¤º

å½“ç”¨æˆ·é€‰æ‹©äº†æŸä¸ª SKU åï¼Œéœ€è¦å°†é€‰æ‹©çš„ã€ç»“æœã€‘å±•ç¤ºç»™ç”¨æˆ·ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“ SKU çš„ç›¸å…³é€»è¾‘æ˜¯åœ¨ç»„ä»¶ä¸­å®Œæˆçš„ï¼Œè¦æƒ³åœ¨é¡µä¸­å±•ç¤ºçš„è¯ï¼Œéœ€è¦è·å–ç»„ä»¶å®ä¾‹

```tsx
// å­˜å‚¨ sku ç»„ä»¶å®ä¾‹
const skuRef = ref();
// ç”¨äº SKU å±•ç¤ºçš„è§„æ ¼æ–‡æœ¬ â—ï¸ è¿™é‡Œæ˜¯åç«¯çš„å•†å“è¯¦æƒ…æ¥å£æ²¡ç”¨è¿”å›è§„æ ¼æ–‡æœ¬ï¼Œæ‰€ä»¥ä¸€å¼€å§‹è§„æ ¼æ–‡æœ¬æ˜¯ä¸ºç©ºçš„ï¼Œéœ€è¦åœ¨é€‰æ‹©è§„æ ¼åï¼Œå°†è§„æ ¼æ–‡æœ¬æ‹¼æ¥èµ·æ¥
const selectArrText = computed(() => skuRef.value?.selectArr.join(' ').trim());
```