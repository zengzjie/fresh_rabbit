## ç™»é™†æ¨¡å—

![image-20230227181550920](https://cdn.jsdelivr.net/gh/zengzjie/picgo-image@main/static_files/202302271815978.png)

å°ç¨‹åºä¸­çš„ç™»é™†æ˜¯é€šè¿‡ç”¨æˆ·æˆæƒçš„å½¢å¼è¯»å–å¾—åˆ°çš„ï¼Œç”¨æˆ·æˆæƒåå¼€å‘è€…å¾—åˆ°ä¿¡æ¯åå¸®ç”¨æˆ·å®Œæˆæ³¨å†Œ/ç™»å½•ã€‚

### ğŸ“±Login

![image-20230227181913204](https://cdn.jsdelivr.net/gh/zengzjie/picgo-image@main/static_files/202302271819260.png)

å°ç¨‹åºã€è§„å®šã€‘è¦æƒ³è·å–ç”¨æˆ·æ‰‹æœºå·çš„æˆæƒï¼Œå¿…é¡»ç”±ç”¨æˆ·ä¸»åŠ¨ã€ç‚¹å‡»æŒ‰é’®ã€‘æ‰å¯ä»¥ï¼Œå¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼š

```vue
<button class="button phone" open-type="getPhoneNumber" @getphonenumber="onGetphonenumber">
  <text class="icon icon-phone"></text>
    æ‰‹æœºå·å¿«æ·ç™»å½•
</button>
```

`open-type` æ˜¯ button ç»„ä»¶éå¸¸é‡çš„å±æ€§ï¼Œé€šè¿‡å®ƒèƒ½å¤Ÿä½¿ç”¨ button è·å–å¦‚æœè°ƒç”¨ API çš„èƒ½åŠ›ï¼Œå°† `open-type` å±æ€§çš„å€¼è®¾ç½®ä¸º `getPhoneNumber` åï¼Œå½“ç”¨æˆ·ç‚¹å‡»æŒ‰é’®æ—¶ä¼šå¼¹å‡ºç”¨æˆ·æˆæƒçª—å£ã€‚ï¼ˆä¸ªäººè´¦å·ä¸æ”¯æŒè·å–ç”¨æˆ·æ‰‹æœºå·ï¼‰

åœ¨ç”¨æˆ·è¿›è¡Œæˆæƒçš„è¿‡ç¨‹ä¸­ï¼ˆå…è®¸/æ‹’ç»ï¼‰ä¼šè§¦å‘ä¸€ä¸ªäº‹ä»¶ `getphonenumber`ï¼Œåœ¨è¿™ä¸ªäº‹ä»¶å›è°ƒå‡½æ•°ä¸­å¯ä»¥è·å–ç”¨æˆ·åŠ å¯†åçš„æ‰‹æœºå·ç ä¿¡æ¯

å‡ºäºå®‰å…¨è€ƒè™‘è·å–åˆ°çš„æ‰‹æœºå·ç ä¿¡æ¯æ˜¯åŠ å¯†ç çš„ï¼Œåç«¯éœ€è¦è¿›è¡Œè§£å¯†åæ‰å¯ä»¥ä½¿ç”¨ï¼Œè€Œè¦æƒ³è§£å¯†æ‰‹æœºå·ç ä¿¡æ¯ï¼Œæ— åç«¯éœ€è¦ä¸€ä¸ªå…³é”®çš„æ•°æ® codeï¼ˆç™»å½•å‡­è¯ï¼‰ï¼Œå®ƒæ˜¯ç”±è°ƒç”¨ `wx.login` å¾—åˆ°çš„

```tsx
// è·å–ç”¨æˆ·æ‰‹æœºå·
const onGetphonenumber = async (ev: any) => {
  try {
    // è·å– encryptedData, iv å‚æ•°
    const { encryptedData, iv } = ev.detail;
    console.log(encryptedData, iv, 'encryptedData, iv');
    // è°ƒç”¨å‘é€å¾®ä¿¡ç™»å½•è¯·æ±‚
    const profile = await postLoginWxMin({
      code, // å¿…å¡«å‚æ•°ï¼šéœ€é€šè¿‡ wx.login() è·å–çš„ code
      encryptedData,
      iv
    });
    // æˆæƒç™»å½•æˆåŠŸåç»­é€»è¾‘
    loginSuccess(profile);
  } catch {
    // ç™»å½•æˆ–æ³¨å†Œå¤±è´¥
    uni.showToast({ title: 'ç™»å½•å¤±è´¥!', icon: 'none' });
  }
};
```

æ¥å£è°ƒç”¨ï¼š

æ¥å£åœ°å€ï¼š/login/wxMin

è¯·æ±‚æ–¹å¼ï¼šPOST

ç™»å½•æƒé™: å¦

è¯·æ±‚å‚æ•°ï¼š

**Body**

| å­—æ®µåç§°      | æ˜¯å¦å¿…é¡» | é»˜è®¤å€¼ | å¤‡æ³¨                         |
| ------------- | -------- | ------ | ---------------------------- |
| code          | æ˜¯       | æ—      | wx.login è·å–                |
| iv            | æ˜¯       | æ—      | getphonenumberäº‹ä»¶å›è°ƒä¸­è·å– |
| encryptedData | æ˜¯       | æ—      | getphonenumberäº‹ä»¶å›è°ƒä¸­è·å– |

æˆåŠŸå“åº”çš„æ•°æ®ï¼š

| å­—æ®µåç§° | æ•°æ®ç±»å‹ | å¤‡æ³¨       |
| -------- | -------- | ---------- |
| id       | String   | ç”¨æˆ·æ ‡è¯†   |
| account  | String   | è´¦æˆ·åç§°   |
| avatar   | String   | ç”¨æˆ·å¤´åƒ   |
| mobile   | String   | ç”¨æˆ·æ‰‹æœºå· |
| nickname | String   | ç”¨æˆ·æ˜µç§°   |
| token    | String   | ç™»å½•å‡­è¯   |

```tsx
/**
 * å°ç¨‹åºç™»å½•
 * @param data
 */
export function postLoginWxMin(data: PostLoginWxMinData) {
  return http<LoginWxMinResult>({
    method: 'POST',
    url: '/login/wxMin',
    data: data
  });
}
```

â—ï¸æ¨¡æ‹Ÿæ‰‹æœºå·ç™»é™†

æˆæƒè·å–æ‰‹æœºå·çš„åŠŸèƒ½ **ç›®å‰è¯¥æ¥å£é’ˆå¯¹éä¸ªäººå¼€å‘è€…ï¼Œä¸”å®Œæˆäº†è®¤è¯çš„å°ç¨‹åºå¼€æ”¾ï¼ˆä¸åŒ…å«æµ·å¤–ä¸»ä½“ï¼‰**

å®˜æ–¹è¯´æ˜ï¼š[https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/getPhoneNumber.html](https://gitee.com/link?target=https%3A%2F%2Fdevelopers.weixin.qq.com%2Fminiprogram%2Fdev%2Fframework%2Fopen-ability%2FgetPhoneNumber.html)

æ¥å£è°ƒç”¨ï¼š

æ¥å£åœ°å€ï¼š/login/wxMin/simple

è¯·æ±‚æ–¹å¼ï¼šPOST

ç™»å½•æƒé™: å¦

è¯·æ±‚å‚æ•°ï¼š

**Body**

| å­—æ®µåç§°    | æ˜¯å¦å¿…é¡» | é»˜è®¤å€¼ | å¤‡æ³¨         |
| ----------- | -------- | ------ | ------------ |
| phoneNumber | æ˜¯       | æ—      | æ¨¡æ‹Ÿçš„æ‰‹æœºå· |

```tsx
 /**
 * å°ç¨‹åºç™»å½•_å†…æµ‹ç‰ˆ
 * @param phoneNumber æ¨¡æ‹Ÿçš„æ‰‹æœºå·ç 
 */
export function postLoginWxMinSimple(phoneNumber: string) {
  return http<LoginWxMinResult>({
    method: 'POST',
    url: '/login/wxMin/simple',
    data: {
      phoneNumber: phoneNumber
    }
  });
}
```

### ğŸ‘¨ğŸ»â€ğŸ’» ç”¨æˆ·ä¿¡æ¯å­˜å‚¨

ç”±äºé€‰ç”¨çš„æ˜¯ Vue3 çš„ç‰ˆæœ¬ï¼Œæ‰€ä»¥è¿™é‡Œé€‰æ‹©çš„çŠ¶æ€ç®¡ç†åº“ä¸ºğŸ `Pinia` ï¼Œç”¨æˆ·ä¿¡æ¯å­˜å‚¨åœ¨ `Stroe` ä¸­ï¼Œæ–¹ä¾¿å„ä¸ªé¡µé¢å’Œç»„ä»¶è·å–ç”¨æˆ·ä¿¡æ¯ã€‚

`/src/stores/index.ts`

```tsx
import { createPinia } from 'pinia';
// pinia æŒä¹…åŒ–å­˜å‚¨
import persist from 'pinia-plugin-persistedstate';

// åˆ›å»º pinia å®ä¾‹
const pinia = createPinia();
// ä¸º pinia æ·»åŠ æŒä¹…åŒ–å­˜å‚¨æ’ä»¶
pinia.use(persist);

export default pinia;

// ç»Ÿä¸€å¯¼å‡º
export * from './modules/user';
```

`/src/stores/modules/user.ts`

```tsx
import { LoginWxMinResult } from '@/types/login';
import { defineStore } from 'pinia';
import { computed, ref } from 'vue';

export const useMemberStore = defindStore('user', () => {
  // ä¼šå‘˜ä¿¡æ¯
  const profile = ref<LoginWxMinResult>({} as LoginWxMinResult);
  
  /**
   * @description: è®¾ç½®ä¼šå‘˜ä¿¡æ¯
   * @param {LoginWxMinResult} ä¼šå‘˜ä¿¡æ¯
   * @return {*}
   */
  const setProfileInfo = (info: LoginWxMinResult) => {
    profile.value = info;
  };
  
  /**
   * @description: æ¸…ç©ºä¼šå‘˜ä¿¡æ¯
   * @return {*}
   */
   const clearProfileInfo = () => {
     profile.value = {} as LoginWxMinResult;
   };
  
  /**
   * @description: æ˜¯å¦ç™»é™†
   * @return {*}
   */
   const isLogin = computed(() => Boolean(profile.value.token));
  
   return {
      profile,
      setProfileInfo,
      clearProfileInfo,
      isLogin
    };
},
{
	//persist: true // è¿™ç§å†™æ³•åœ¨å°ç¨‹åºä¸­æ˜¯ä¸ç”Ÿæ•ˆçš„ï¼Œå› ä¸ºå°ç¨‹åºçš„æœ¬åœ°å­˜å‚¨è·ŸH5çš„apiä¸åŒ
  persist: {
    // storage: localStorage,
    // ğŸ¯ æ”¹é€ æˆå°ç¨‹åºçš„ api
    storage: {
      // è®¾ç½®
      setItem(key, value) {
        uni.setStorageSync(key, value);
      },
      // è·å–
      getItem(key) {
        uni.getStorageSync(key);
      }
    }
  }
});
```

åœ¨å¾®ä¿¡ç™»å½•æˆåŠŸåä¼šå¾—åˆ°ä¸€ä¸ª tokenï¼ˆå‡­è¯ï¼‰åç«¯åŸºäºè¿™ä¸ª token æ¥åˆ†è¾¨ç”¨æˆ·æ˜¯å¦å·²ç™»å½•ï¼Œå› æ­¤åœ¨æ¯æ¬¡å‘èµ·è¯·æ±‚çš„æ—¶å€™éƒ½éœ€è¦å°†è¿™ä¸ª token å†æ¬¡å‘é€ç»™æœåŠ¡ç«¯è¿›è¡Œæ ¡éªŒã€‚

è¿™ä¸ª token é€šå¸¸ä¼šä»¥ HTTP å¤´ä¿¡æ¯çš„å½¢å¼è¿›è¡Œä¼ é€’ï¼Œåœ¨å°å…”é²œå„¿ä¸­ä½¿ç”¨çš„è¯·æ±‚å¤´ä¸º Authorizationï¼Œæˆ‘ä»¬å…ˆå°† token è®°å½•ä¸‹æ¥ï¼Œç„¶ååœ¨æ¯æ¬¡è¯·æ±‚çš„æ—¶å€™å°† token èµ‹å€¼ç»™ Authorization ä¼ é€’ç»™åç«¯ã€‚

```tsx
const loginSuccess = async (profile: LoginWxMinResult) => {
  // ä¿å­˜ç”¨æˆ·ä¿¡æ¯åˆ° Store ä¸­
  memberStore.setProfileInfo(profile);
  // ç™»å½•æˆåŠŸæç¤º
  uni.showToast({ icon: 'success', title: 'ç™»å½•æˆåŠŸ' });
  setTimeout(() => {
    // åé€€å›åˆ°ä¸Šä¸€é¡µ
    uni.navigateBack({});
  }, 500);
};
```

## ğŸ‘¤ ä¸ªäººä¿¡æ¯

![image-20230227200812952](https://cdn.jsdelivr.net/gh/zengzjie/picgo-image@main/static_files/202302272008060.png)

#### 1.1 å±•ç¤ºä¿¡æ¯

åœ¨ç”¨æˆ·è¿›å…¥åˆ°ã€æˆ‘çš„ã€‘é¡µé¢åï¼Œæˆ‘ä»¬è¦æŠŠå½“å‰ç™»é™†ç”¨æˆ·çš„ä¿¡æ¯ï¼ˆæ˜µç§°ï¼Œå¤´åƒï¼‰è¿›è¡Œå±•ç¤ºã€‚

ç™»é™†çŠ¶æ€ï¼š

åªæœ‰ç”¨æˆ·å¤„äºç™»é™†çŠ¶æ€çš„æ—¶å€™æˆ‘ä»¬æ‰éœ€è¦å°†ç”¨æˆ·çš„ä¿¡æ¯è¿›è¡Œå±•ç¤ºï¼Œå¦åˆ™éƒ½ç»Ÿä¸€å±•ç¤ºé»˜è®¤å€¼ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åšçš„æ˜¯é¦–å…ˆéœ€è¦æ£€æµ‹ç”¨æˆ·çš„ç™»å½•çŠ¶æ€ï¼Œè€Œç™»å½•çŠ¶æ€æˆ‘ä»¬å¯ä»¥é€šè¿‡ `Pinia` ä¸­å­˜å‚¨çš„ `userModule` ä¸­å»å–å‡º `isLogin` æ¥åˆ¤æ–­ã€‚

```tsx
import { useMemberStore } from '@/stores';
import { storeToRefs } from 'pinia';

const memberStore = useMemberStore();
const { isLogin, profile } = storeToRefs(memberStore);
```

```vue
<!-- ä¸ªäººèµ„æ–™ -->
      <view class="profile">
        <view class="overview">
          <navigator v-if="isLogin" url="./profile" hover-class="none">
            <image mode="aspectFill" class="avatar" :src="profile.avatar"></image>
          </navigator>
          <!-- æœªç™»å½•ï¼šç‚¹å‡»å¤´åƒè·³è½¬ç™»å½•é¡µ -->
          <navigator v-else url="/pages/login/index" hover-class="none">
            <!-- src="https://pcapi-xiaotuxian-front-devtest.itheima.net/miniapp/uploads/avatar_3.jpg" -->
            <image
              class="avatar"
              src="https://raw.githubusercontent.com/zengzjie/picgo-image/main/static_files/IMG_6247.JPG"
            ></image>
          </navigator>
          <view class="meta">
            <view v-if="isLogin" class="nickname" @tap="goToProfile">
              {{ profile.nickname }}
            </view>
            <!-- æœªç™»å½•ï¼šç‚¹å‡»æ–‡å­—è·³è½¬ç™»å½•é¡µ -->
            <navigator v-else url="/pages/login/index" hover-class="none" class="nickname">æœªç™»å½•</navigator>
            <view class="extra">
              <text v-if="!isLogin" class="tips">ç‚¹å‡»ç™»å½•è´¦å·</text>
              <template v-else>
                <text class="update">æ›´æ–°å¤´åƒæ˜µç§°</text>
                <text class="relogin">åˆ‡æ¢è´¦å·</text>
              </template>
            </view>
          </view>
        </view>
        <navigator class="settings" url="./settings" hover-class="none">è®¾ç½®</navigator>
      </view>
```

æ ¹æ®ç”¨æˆ·çš„ç™»å½•çŠ¶æ€å†³å®šç”¨æˆ·å¯¹ä¸ªäººä¿¡æ¯å†…å®¹è¿›è¡Œç‚¹å‡»æ—¶éœ€è¦è·³è½¬åˆ°å“ªä¸ªé¡µé¢ï¼Œå¦‚æœç™»å½•äº†åˆ™è·³è½¬åˆ°æ›´æ–°ä¸ªäººä¿¡æ¯é¡µé¢ï¼Œå¦åˆ™è·³è½¬åˆ°ç™»å½•é¡µé¢ã€‚

![image-20230227203037507](https://cdn.jsdelivr.net/gh/zengzjie/picgo-image@main/static_files/202302272030577.png)

#### 1.2 æ›´æ–°å¤´åƒä¿¡æ¯

ç”¨æˆ·å¤´åƒ

ä¿®æ”¹å¤´åƒéœ€è¦è°ƒç”¨å°ç¨‹åºçš„ `chooseMedia` çš„ API è¯»å–ç”¨æˆ·ç›¸å†Œæˆ–è€…æ‹ç…§ã€‚

```tsx
// ä¿®æ”¹å¤´åƒ
const changeAvatar = () => {
  uni.chooseMedia({
    count: 1,
    mediaType: ['image'],
    sourceType: ['album'],
    success: function (res) {
      console.log(JSON.stringify(res), 'JSONres');
      const filePath = res.tempFiles[0].tempFilePath;
      uni.uploadFile({
        url: '/member/profile/avatar', // æ¥å£åœ°å€
        name: 'file',
        filePath: filePath,
        success(uploadFileRes) {
          // æ›´æ–°å½“å‰é¡µé¢çš„å¤´åƒ
          personalInfo.value.avatar = filePath;
          // åŒæ­¥ä¿®æ”¹æœ¬åœ° Store çš„å¤´åƒ
          setProfileInfo({
            ...profile,
            avatar: filePath
          });
          // æç¤ºç”¨æˆ·
          uni.showToast({ icon: 'success', title: 'å¤´åƒæ›´æ–°æˆåŠŸ~' });
        }
      });
    }
  });
};
```

åœ¨é¡¹ç›®å‰æœŸå·¥ä½œä¸­ï¼Œæˆ‘ä»¬åœ¨ `http` ä¸­å°†å°ç¨‹åºä¸­çš„ `uni.uploadFile` è¿™ä¸ª API æ·»åŠ åˆ°å…¨å±€æ‹¦æˆªå™¨ä¸­ã€‚

æ¥å£è°ƒç”¨ï¼š

æ¥å£åœ°å€ï¼š/member/profile/avatar

è¯·æ±‚æ–¹å¼ï¼šPOST

ç™»å½•æƒé™: æ˜¯

è¯·æ±‚å‚æ•°ï¼š

**Body**

| å­—æ®µåç§° | æ˜¯å¦å¿…é¡» | é»˜è®¤å€¼ | å¤‡æ³¨                 |
| -------- | -------- | ------ | -------------------- |
| filePath | æ˜¯       | æ—      | æ–°å¤´åƒ               |
| name     | æ˜¯       | æ—      | åç«¯æ¥å£æ•°æ®å­—æ®µåç§° |

#### 1.3 æ›´æ–°åŸºæœ¬ä¿¡æ¯

åœ¨ç”¨æˆ·å¤„ç†ç™»å½•çŠ¶æ€çš„æ—¶å€™ï¼Œç”¨æˆ·èƒ½å¤Ÿå¯¹å„è‡ªçš„åŸºæœ¬ä¿¡æ¯å’Œç”¨æˆ·å¤´åƒè¿›è¡Œä¿®æ”¹ï¼Œä¸è¿‡åœ¨è¿›è¡Œä¸ªä¿®æ”¹ä¹‹å‰éœ€è¦å…ˆå°†ç™»å½•ç”¨æˆ·çš„ä¿¡æ¯æŸ¥è¯¢å‡ºæ¥ï¼Œç„¶åå†åœ¨æ­¤åŸºç¡€ä¸Šè¿›è¡Œä¿®æ”¹ã€‚

æ¥å£è°ƒç”¨ï¼š

æ¥å£åœ°å€ï¼š/member/profile

è¯·æ±‚æ–¹å¼ï¼šGET

ç™»å½•æƒé™: æ˜¯

è¯·æ±‚å‚æ•°ï¼šæ— 

æˆåŠŸå“åº”çš„æ•°æ®ï¼š

| å­—æ®µåç§°   | æ•°æ®ç±»å‹ | å¤‡æ³¨         |
| ---------- | -------- | ------------ |
| id         | String   | ç”¨æˆ·ID       |
| account    | String   | ç”¨æˆ·è´¦å·åç§° |
| nickname   | String   | ç”¨æˆ·æ˜µç§°     |
| avatar     | String   | ç”¨æˆ·å¤´åƒåœ°å€ |
| gender     | String   | ç”¨æˆ·æ€§åˆ«     |
| profession | String   | ç”¨æˆ·èŒä¸š     |
| birthday   | String   | ç”¨æˆ·ç”Ÿæ—¥     |

```tsx
/**
 * ä¸ªäººä¿¡æ¯-ä¿®æ”¹
 */
export function putMemberProfile(data: PutMemberProfileData) {
  return http<GetMemberProfileResult>({
    method: 'PUT',
    url: '/member/profile',
    data: data
  });
}
```

æˆ‘ä»¬é€šè¿‡ `input` ã€`radio` ã€`picker` çš„ `change` äº‹ä»¶å»ç›‘å¬é€‰ä¸­çš„å€¼æœ€ç»ˆåœ¨ `form` çš„ `submit` äº‹ä»¶ä¸­å»ç»„åˆæäº¤æ›´æ–°ç”¨æˆ·çš„ä¿¡æ¯ï¼Œå¹¶ä¸”å°†ä¿¡æ¯åŒæ­¥æ›´æ–°åˆ° `Store` ä¸­

```tsx
const submitForm = async () => {
  // è·å–åç«¯ä¿®æ”¹æ‰€éœ€å­—æ®µ
  const { birthday, gender, nickname, profession } = personalInfo.value;
  // ğŸ”” æ•°ç»„æŒ‰ä¸‹æ ‡è§£æ„ çœ å¸‚ åŒº çš„ç¼–ç 
  const [provinceCode, cityCode, countyCode] = fullLocationCode;
  console.log(birthday, gender, nickname, profession, provinceCode, cityCode, countyCode, 'personalInfo');
  // è°ƒç”¨ä¿®æ”¹ä¸ªäººä¿¡æ¯æ¥å£
  await putMemberProfile({
    birthday,
    gender,
    nickname,
    profession,
    provinceCode,
    cityCode,
    countyCode
  });
  // æç¤ºç”¨æˆ· - åé€€è¿”å›ä¸Šä¸€é¡µï¼ˆæ­£å¸¸çš„æµç¨‹ï¼šä¸ªäººä¸­å¿ƒç‚¹å‡»ä¿®æ”¹èµ„æ–™è·³è½¬åˆ°å½“å‰é¡µï¼Œä¿®æ”¹å®Œæˆåé€€å›å»ï¼‰
  uni.showToast({
    icon: 'success',
    title: 'ä¿å­˜æˆåŠŸ',
    success: () =>
      setTimeout(() => {
        uni.navigateBack();
      }, 1000)
  });
  // ğŸ› åŒæ­¥æ›´æ–° Store çš„æ˜µç§°å’ŒèŒä¸š
  setProfileInfo({
    ...profile,
    nickname,
    profession
  });
};
```

#### 1.4 è‡ªå®šä¹‰å¤´éƒ¨å¯¼èˆªæ ·å¼

ğŸ”§ é€‚é…ä¸åŒæœºå‹çš„è‡ªå®šä¹‰å¤´éƒ¨å¯¼èˆªï¼Œå¹¶ä¸”å¯¼èˆªèƒŒæ™¯å›¾çš„é«˜åº¦è‡ªé€‚åº”

![image-20230227235551792](https://cdn.jsdelivr.net/gh/zengzjie/picgo-image@main/static_files/202302272355904.png)

å¸ƒå±€åˆ†æï¼š

```vue
<template>
  <view class="header" :style="style">
    <view
      class="header-box"
      :style="[
        {
          height: props.bgHeight ? props.bgHeight + 'rpx' : customBarHeight + 'px',
          paddingTop: statusBarHeight + 'px',
          color: titleColor,
          background: bgAttribute
        }
      ]"
    >
      <view @tap="goBack">
        <slot name="back">è¿”å›</slot>
      </view>
      <view class="header-box__title">
        {{ title }}
      </view>
      <view style="width: 32px"></view>
    </view>
  </view>
</template>
```

```tsx
import { onLoad } from '@dcloudio/uni-app';
import { ref, computed } from 'vue';
import useCurrentInstance from '@/hooks/useCurrentInstance';

const { globalProperties } = useCurrentInstance();

// è‡ªå®šä¹‰æ¡å½¢å›¾é«˜åº¦
const customBarHeight = ref(0);
// çŠ¶æ€æ é«˜åº¦
const statusBarHeight = ref(0);
// å¦‚æœæœ‰ä¼ å…¥è‡ªå®šä¹‰èƒŒæ™¯å›¾é«˜åº¦åˆ™ä¼˜å…ˆä½¿ç”¨ï¼Œå¦åˆ™ç›´æ¥é‡‡å–è‡ªå®šä¹‰æ é«˜åº¦
const style = computed(() => `height: ${props.bgHeight ? props.bgHeight + 'rpx' : customBarHeight.value + 'px'}`);

onLoad(() => {
  // ä¸åŒæœºå‹çš„çŠ¶æ€æ é«˜åº¦
  statusBarHeight.value = globalProperties.$StatusBar + 10;
  // è‡ªå®šä¹‰æ çš„é«˜åº¦
  customBarHeight.value = globalProperties.$CustomBar + 10;
});

const goBack = () => {
  uni.navigateBack();
};
```

ç¤ºä¾‹ï¼š

```tsx
<XtxHeaderBar
  title="ä¸ªäººä¿¡æ¯"
  title-color="#fff"
  :bg-attribute="bgAttribute"
  :bg-height="globalProperties.$StatusBar + 392"
>
  <template #back>
    <view class="icon-left" style="width: 32px; transform: translateY(3px)"></view>
  </template>
</XtxHeaderBar>

// èƒŒæ™¯å±æ€§
const bgAttribute = ref(
  `url(https://pcapi-xiaotuxian-front-devtest.itheima.net/miniapp/images/order_bg.png) no-repeat 0 / auto ${
    globalProperties.$StatusBar + 392
  }rpx`
);
```

