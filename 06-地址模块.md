## åœ°å€ç®¡ç†

- è·å–ä¸åŒç±»å‹çš„è¡¨å•æ•°æ®
- åŠ¨æ€è®¾ç½®å¯¼èˆªæ çš„æ ‡é¢˜ï¼ˆæ–°å¢å’Œä¿®æ”¹ï¼‰
- èƒ½å¤Ÿå®Œæˆæ”¶è·åœ°å€çš„å¢åˆ æ”¹æŸ¥
- åŸºäº `uni-ui` çš„åŸºç¡€ç»„ä»¶é…åˆè‡ªå®šä¹‰å°è£…çš„è¡¨å•ç»„ä»¶è”åˆä½¿ç”¨ï¼Œæä¾› `validate` å¯¹è¡¨å•æ•°æ®è¿›è¡ŒéªŒè¯çš„åŠŸèƒ½

### 1.1  ğŸ‘€ æŸ¥çœ‹åœ°å€

![image-20230228182054517](https://cdn.jsdelivr.net/gh/zengzjie/picgo-image@main/static_files/202302281820564.png)

```vue
<template>
  <view class="viewport">
    <scroll-view v-if="!loading && addressList.length > 0" scroll-y enhanced>
      <view class="address">
        <uni-swipe-action>
          <uni-swipe-action-item v-for="item in addressList" :key="item.id" class="swipe-cell">
            <view class="item" @tap="changeAddress(item)">
              <view class="user">
                {{ item.receiver }}
                <text>{{ item.contact }}</text>
                <text v-if="item.isDefault === 1" class="badge">é»˜è®¤</text>
              </view>
              <view class="locate">{{ item.fullLocation }}{{ item.address }}</view>
              <!-- ğŸ› æ·»åŠ é˜»æ­¢å†’æ³¡ -->
              <navigator :url="`./form?id=${item.id}`" class="edit" hover-class="none" @tap.stop="() => {}">
                ä¿®æ”¹
              </navigator>
            </view>
            <template #right>
              <view class="swipe-cell--action">
                <button class="swipe-cell--action__delete" @tap="deleteAddressBtn(item.id)">åˆ é™¤</button>
              </view>
            </template>
          </uni-swipe-action-item>
        </uni-swipe-action>
      </view>
    </scroll-view>
    <view v-if="!loading && addressList.length === 0" class="empty">
      <uni-icons type="location" size="60" color="rgb(192, 196, 204)"></uni-icons>
      <text class="blank">æ”¶è´§åœ°å€ä¸ºç©º</text>
    </view>
    <view v-if="!loading" class="footer" :class="{ 'safe-area-inset-bottom': true }">
      <button class="button" @tap="handleAddress">æ–°å»ºåœ°å€</button>
    </view>
  </view>
</template>
```

æ¥å£è°ƒç”¨ï¼š

æ¥å£åœ°å€ï¼š/member/address

è¯·æ±‚æ–¹å¼ï¼šGET

ç™»å½•æƒé™: æ˜¯

è¯·æ±‚å‚æ•°ï¼šæ— 

æˆåŠŸå“çš„æ•°æ®ï¼š

| å­—æ®µåç§°     | æ•°æ®ç±»å‹ | å¤‡æ³¨           |
| ------------ | -------- | -------------- |
| id           | String   | ID             |
| receiver     | String   | æ”¶è´§äººå§“å     |
| contact      | String   | æ”¶è´§äººè”ç³»æ–¹å¼ |
| fullLocation | String   | å®Œæ•´æ”¶è´§åœ°å€   |
| isDefault    | Number   | æ˜¯å¦ä¸ºé»˜è®¤     |

```tsx
/**
 * è·å–æ”¶è´§åœ°å€åˆ—è¡¨
 */
export function getMemberAddress() {
  return http<MemberAddressItem[]>({
    method: 'GET',
    url: '/member/address'
  });
}
```



### 1.2 â• æ·»åŠ åœ°å€

![image-20230228181830351](https://cdn.jsdelivr.net/gh/zengzjie/picgo-image@main/static_files/202302281818531.png)

å¸ƒå±€åˆ†æï¼š

```vue
<template>
  <view class="viewport">
    <view class="card">
      <XtxForm ref="formRef" :model="form" :rules="rules" label-position="left">
        <XtxFormItem key="receiver" label="å§“å" prop="receiver" :required="true">
          <XtxInput v-model="form.receiver" placeholder="è¯·å¡«å†™æ”¶è´§äººå§“å" />
        </XtxFormItem>
        <XtxFormItem
          key="contact"
          label="æ‰‹æœºå·ç "
          prop="contact"
          :required="true"
          :label-width="190"
          left-icon="phone"
        >
          <XtxInput v-model="form.contact" placeholder="è¯·å¡«å†™æ”¶è´§äººæ‰‹æœºå·ç " />
        </XtxFormItem>
        <XtxFormItem
          key="region"
          label="æ”¶è·åŸå¸‚"
          prop="region"
          :required="true"
          :label-width="190"
          left-icon="location"
        >
          <XtxPicker
            v-model="form.region"
            mode="region"
            placeholder="è¯·é€‰æ‹©æ”¶è´§äººæ‰€åœ¨åŸå¸‚"
            :presentation-text="form.regionAddress"
            @change="handleRegionChange"
          />
        </XtxFormItem>
        <XtxFormItem key="address" label="è¯¦ç»†åœ°å€" prop="address" :required="true" :label-width="190" left-icon="home">
          <XtxInput v-model="form.address" placeholder="è¯·å¡«å†™è¡—é“ã€æ¥¼ç‰Œå·ä¿¡æ¯" />
        </XtxFormItem>
        <XtxFormItem key="isDefault" label="è®¾ç½®é»˜è®¤åœ°å€" :label-width="230" left-icon="notification">
          <template #right>
            <switch
              :checked="form.isDefault === 1"
              color="#27ba9b"
              style="transform: scale(0.7)"
              @change="isDefaultChange"
            />
          </template>
        </XtxFormItem>
      </XtxForm>
    </view>
    <button class="button" @tap="submitFrom">{{ props.id ? 'ä¿å­˜' : 'ç¡®å®š' }}</button>
  </view>
</template>
```

```tsx
// modelæ•°æ®
const form = reactive({
  receiver: '', // æ”¶è´§äººå§“å
  contact: '', // æ”¶è´§äººç”µè¯
  region: [], // çœå¸‚åŒºç¼–ç 
  regionAddress: '', // çœå¸‚åŒºåœ°å€
  address: '', // è¯¦ç»†åœ°å€
  isDefault: 0, // é»˜è®¤æ”¶è´§åœ°å€
  provinceCode: '', // çœç¼–ç 
  cityCode: '', // å¸‚ç¼–ç 
  countyCode: '' // åŒºç¼–ç 
} as PostMemberAddressData);

// è·å– form çš„å®ä¾‹ï¼Œè°ƒç”¨å…¶å†…éƒ¨çš„æ–¹æ³•
const formRef = ref();

// æ ¡éªŒè§„åˆ™
const rules: Rules = reactive({
  receiver: [{ required: true, message: 'è¯·å¡«å†™æ”¶è´§äººå§“å', trigger: ['blur', 'change'] }],
  contact: [
    { required: true, message: 'è¯·å¡«å†™æ”¶è´§äººç”µè¯', trigger: ['blur', 'change'] },
    // ç”±äºå°ç¨‹åºç­‰çš„é™åˆ¶, ä¸èƒ½ä¼ é€’æ­£åˆ™è¡¨è¾¾å¼, éœ€è¦é€šè¿‡å­—ç¬¦ä¸²æ–¹å¼ä¼ é€’
    { pattern: '^1[3-9]\\d{9}$', message: 'è¯·å¡«å†™æ­£ç¡®çš„æ‰‹æœºå·ç ', trigger: 'change' }
  ],
  region: [{ type: 'array', required: true, message: 'è¯·é€‰æ‹©çœå¸‚åŒº', trigger: ['blur', 'change'] }],
  address: [{ required: true, message: 'è¯·å¡«å†™è¯¦ç»†åœ°å€', trigger: ['blur', 'change'] }]
});
```

è€ƒè™‘åˆ°åœ¨å°ç¨‹åºä¸­ä½¿ç”¨è¡¨å•çš„ç”¨æ³•ä¼šè·Ÿæˆ‘ä»¬æ‰€ç†Ÿæ‚‰çš„UIåº“çš„è¡¨å•ä¸ä¸€æ ·ï¼Œè¿™è¾¹å°±ç›´æ¥å°†è¡¨å•ç»„ä»¶å°è£…äº†èµ·æ¥ä½¿ç”¨ï¼Œçœ‹ç»“æ„ä½“ä½¿ç”¨æ ¼å¼æ˜¯è·Ÿ `ElementUI` ã€`Vant` ä¹‹ç±»çš„è¡¨å•ä½¿ç”¨æ˜¯ç›¸å·®ä¸å¤§çš„ã€‚

âœ… æäº¤è¡¨å•åˆ™ç›´æ¥è°ƒç”¨è¡¨å•æš´éœ²å‡ºæ¥çš„æ•´ä½“æ ¡éªŒæ–¹æ³•å³å¯ï¼š

```tsx
const submitFrom = () => {
  // å…ˆæ ¡éªŒè¡¨å•
  formRef.value.validate(async (valid: boolean) => {
    if (valid) {
      // æ ¡éªŒæˆåŠŸ...
    }
  });
};
```

æ¥å£è°ƒç”¨ï¼š

æ¥å£åœ°å€ï¼š/member/address

è¯·æ±‚æ–¹å¼ï¼šPOST

ç™»å½•æƒé™: æ˜¯

è¯·æ±‚å‚æ•°ï¼š

**Body**

| å­—æ®µåç§°     | æ˜¯å¦å¿…é¡» | é»˜è®¤å€¼ | å¤‡æ³¨                           |
| ------------ | -------- | ------ | ------------------------------ |
| receiver     | æ˜¯       | æ—      | æ”¶è´§äººå§“å                     |
| contact      | æ˜¯       | æ—      | æ”¶è´§äººè”ç³»æ–¹å¼                 |
| provinceCode | æ˜¯       | æ—      | è¡Œæ”¿çœå¯¹åº”çš„ code              |
| cityCode     | æ˜¯       | æ—      | è¡Œæ”¿å¸‚å¯¹åº”çš„ code              |
| countyCode   | æ˜¯       | æ—      | è¡Œæ”¿åŒºå¿å¯¹åº”çš„ code            |
| address      | æ˜¯       | æ—      | æ”¶è´§äººè¯¦ç»†åœ°å€                 |
| isDefault    | æ˜¯       | æ—      | æ˜¯å¦è®¾ç½®ä¸ºé»˜è®¤åœ°å€ï¼ˆæ•°å€¼ç±»å‹ï¼‰ |

```tsx
/**
 * æ·»åŠ æ”¶è´§åœ°å€
 */
export function postMemberAddress(data: PostMemberAddressData) {
  return http({
    method: 'POST',
    url: '/member/address',
    data: data
  });
}
```

### 1.3 âœï¸ ä¿®æ”¹åœ°å€

![image-20230228185106966](https://cdn.jsdelivr.net/gh/zengzjie/picgo-image@main/static_files/202302281851034.png)

ä¿®æ”¹æ˜¯è·Ÿæ–°å¢ä¸€æ ·ï¼Œåªéœ€è¦é€šè¿‡åœ°å€å‚æ•° id æ¥åŒºåˆ†å½“å‰æ˜¯æ–°å¢åœ°å€è¿˜æ˜¯ä¿®æ”¹åœ°å€ï¼Œå¹¶ä¸”åŠ¨æ€è®¾ç½®å¯¼èˆªæ æ ‡é¢˜ã€‚

```tsx
// è®¾ç½®å¯¼èˆªæ ‡é¢˜
onLoad(() => {
  uni.setNavigationBarTitle({
    title: props.id ? 'ç¼–è¾‘åœ°å€' : 'æ–°å¢åœ°å€'
  });
});
```

æ¥å£è°ƒç”¨ï¼š

æ¥å£åœ°å€ï¼š/member/address/:id

è¯·æ±‚æ–¹å¼ï¼šGET

ç™»å½•æƒé™: æ˜¯

è¯·æ±‚å‚æ•°ï¼š

**è·¯å¾„å‚æ•°**

| å­—æ®µåç§° | æ˜¯å¦å¿…é¡» | é»˜è®¤å€¼ | å¤‡æ³¨       |
| -------- | -------- | ------ | ---------- |
| id       | æ˜¯       | æ—      | æ”¶è´§åœ°å€ID |

æˆåŠŸå“åº”çš„æ•°æ®ï¼š

| å­—æ®µåç§°     | æ•°æ®ç±»å‹ | å¤‡æ³¨                |
| ------------ | -------- | ------------------- |
| receiver     | String   | æ”¶è´§äººå§“å          |
| contact      | String   | æ”¶è´§äººè”ç³»æ–¹å¼      |
| provinceCode | Number   | è¡Œæ”¿çœå¯¹åº”çš„ code   |
| cityCode     | Number   | è¡Œæ”¿å¸‚å¯¹åº”çš„ code   |
| countyCode   | Number   | è¡Œæ”¿åŒºå¿å¯¹åº”çš„ code |
| address      | String   | æ”¶è´§äººè¯¦ç»†åœ°å€      |
| isDefault    | Number   | æ˜¯å¦è®¾ç½®ä¸ºé»˜è®¤åœ°å€  |

```tsx
/**
 * æ›´æ–°æ”¶è´§åœ°å€
 * @param id  æ”¶è´§åœ°å€ id
 * @param data æ”¶è´§åœ°å€è¯·æ±‚ä½“å‚æ•°
 */
export function putMemberAddress(id: string, data: PostMemberAddressData) {
  // PS: ä¿®æ”¹æˆåŠŸçš„è¿”å›å€¼å¦‚æœä¸šåŠ¡ä¸­æ²¡ç”¨ï¼Œå¯ä»¥ä¸æŒ‡å®šç±»å‹
  return http({
    method: 'PUT',
    url: `/member/address/${id}`,
    data: data
  });
}
```



### 1.4 âŒ åˆ é™¤åœ°å€

![image-20230228185802168](https://cdn.jsdelivr.net/gh/zengzjie/picgo-image@main/static_files/202302281858231.png)

ç”¨æˆ·å¯ä»¥å¯¹åœ°å€åˆ—è¡¨ä¸­çš„æ”¶è´§åœ°å€è¿›è¡Œåˆ é™¤ï¼Œä½¿ç”¨åˆ°äº†å°ç¨‹åºç»„ä»¶ uni-ui ä¸­çš„ ä¾§æ»‘ç»„ä»¶ã€‚

æ¥å£è°ƒç”¨ï¼š

æ¥å£åœ°å€ï¼š/member/address/:id

è¯·æ±‚æ–¹å¼ï¼šDELETE

ç™»å½•æƒé™: æ˜¯

è¯·æ±‚å‚æ•°ï¼š

**è·¯å¾„å‚æ•°**

| å­—æ®µåç§° | æ˜¯å¦å¿…é¡» | é»˜è®¤å€¼ | å¤‡æ³¨ |
| -------- | -------- | ------ | ---- |
| id       | æ˜¯       | æ—      | ID   |

```tsx
/**
 * åˆ é™¤æ”¶è´§åœ°å€
 * @param id  æ”¶è´§åœ°å€ id
 */
export function deleteMemberAddressById(id: string) {
  // æ³¨æ„ï¼šç±»å‹ä¸ºå•ä¸ªæ”¶è´§åœ°å€ï¼Œä¸è¦å†™æˆæ•°ç»„æ ¼å¼
  return http({
    method: 'DELETE',
    // æ³¨æ„æ¨¡æ¿å­—ç¬¦ä¸² ${id} çš„æ‹¼æ¥
    url: `/member/address/${id}`
  });
}
```